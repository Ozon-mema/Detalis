local Players, UserInputService = game:GetService("Players"), game:GetService("UserInputService")
local player = Players.LocalPlayer

local lastDeathPosition = nil

-- Отслеживание смерти
player.CharacterAdded:Connect(function(character)
    local humanoid = character:WaitForChild("Humanoid")
    humanoid.Died:Connect(function()
        lastDeathPosition = character:GetPivot().Position
        print("Место смерти сохранено:", lastDeathPosition)
    end)
end)

-- Телепорт на место смерти
local function teleportToDeath()
    if not lastDeathPosition then
        warn("Место смерти не найдено")
        return false
    end
    
    local character = player.Character
    if not character then
        warn("Персонаж не найден")
        return false
    end
    
    local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
    if not humanoidRootPart then
        warn("HumanoidRootPart не найден")
        return false
    end
    
    -- Телепортация с небольшим смещением чтобы избежать багов
    local success = pcall(function()
        humanoidRootPart.CFrame = CFrame.new(lastDeathPosition + Vector3.new(0, 3, 0))
    end)
    
    return success
end

-- Горячая клавиша (R)
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.R and not UserInputService:GetFocusedTextBox() then
        teleportToDeath()
    end
end)

-- Автотелепорт при возрождении (опционально)
player.CharacterAdded:Connect(function(character)
    if lastDeathPosition then
        task.wait(0.5) -- Ждем полного появления персонажа
        teleportToDeath()
    end
end)

return teleportToDeath
